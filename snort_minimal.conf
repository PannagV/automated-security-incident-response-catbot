#--------------------------------------------------
#   Minimal Snort Configuration for Windows
#   Compatible with Snort 2.9.20
#--------------------------------------------------

###################################################
# Step #1: Set the network variables
###################################################

# Setup the network addresses you are protecting
ipvar HOME_NET any

# Set up the external network addresses
ipvar EXTERNAL_NET any

# List of DNS servers on your network 
ipvar DNS_SERVERS $HOME_NET

# List of SMTP servers on your network
ipvar SMTP_SERVERS $HOME_NET

# List of web servers on your network
ipvar HTTP_SERVERS $HOME_NET

# List of sql servers on your network 
ipvar SQL_SERVERS $HOME_NET

# List of ssh servers on your network
ipvar SSH_SERVERS $HOME_NET

# List of ftp servers on your network
ipvar FTP_SERVERS $HOME_NET

# List of sip servers on your network
ipvar SIP_SERVERS $HOME_NET

# List of ports you run web servers on
portvar HTTP_PORTS [80,443,8080,8443]

# List of ports you want to look for SHELLCODE on
portvar SHELLCODE_PORTS [0:79,81:65535]

# List of ports you might see oracle attacks on
portvar ORACLE_PORTS [1024:65535]

# List of ports you want to look for SSH connections on
portvar SSH_PORTS [22]

# List of ports you run ftp servers on
portvar FTP_PORTS [21,2100,3535]

# List of ports you run SIP servers on
portvar SIP_PORTS [5060:5061,5600]

# List of file data ports for file inspection
portvar FILE_DATA_PORTS [$HTTP_PORTS,110,143]

# List of GTP ports for GTP preprocessor
portvar GTP_PORTS [2123,2152,3386]

# Path to your rules files
var RULE_PATH ../rules
var SO_RULE_PATH ../so_rules
var PREPROC_RULE_PATH ../preproc_rules

# Reputation paths
var WHITE_LIST_PATH ../rules
var BLACK_LIST_PATH ../rules

###################################################
# Step #2: Configure the decoder
###################################################

# Stop generic decode events
config disable_decode_alerts

# Stop Alerts on experimental TCP options
config disable_tcpopt_experimental_alerts

# Stop Alerts on obsolete TCP options
config disable_tcpopt_obsolete_alerts

# Stop Alerts on T/TCP alerts
config disable_tcpopt_ttcp_alerts

# Stop Alerts on all other TCPOption type events
config disable_tcpopt_alerts

# Stop Alerts on invalid ip options
config disable_ipopt_alerts

# Configure IP / TCP checksum mode
config checksum_mode: all

###################################################
# Step #3: Configure the base detection engine
###################################################

# Configure PCRE match limitations
config pcre_match_limit: 3500
config pcre_match_limit_recursion: 1500

# Configure the detection engine
config detection: search-method ac-bnfa-q search-optimize max-pattern-len 20

# Configure the event queue
config event_queue: max_queue 8 log 5 order_events content_length

###################################################
# Configure protocol aware flushing
###################################################
config paf_max: 16000

###################################################
# Step #4: Configure preprocessors (MINIMAL SET)
###################################################

# Basic IP normalization
preprocessor normalize_ip4
preprocessor normalize_tcp: ips ecn stream
preprocessor normalize_icmp4
preprocessor normalize_ip6
preprocessor normalize_icmp6

# IP defragmentation
preprocessor frag3_global: max_frags 65536
preprocessor frag3_engine: policy windows detect_anomalies overlap_limit 10 min_fragment_length 100 timeout 180

# Stream reassembly (simplified)
preprocessor stream5_global: track_tcp yes, track_udp yes, track_icmp no, max_tcp 262144, max_udp 131072, max_active_responses 2, min_response_seconds 5

preprocessor stream5_tcp: policy windows, detect_anomalies, require_3whs 180, overlap_limit 10, small_segments 3 bytes 150, timeout 180, ports both 21 22 23 25 53 80 110 111 135 139 143 443 993 995 1433

preprocessor stream5_udp: timeout 180

# HTTP inspection (basic)
preprocessor http_inspect: global iis_unicode_map unicode.map 1252 compress_depth 65535 decompress_depth 65535

preprocessor http_inspect_server: server default http_methods { GET POST PUT DELETE HEAD OPTIONS TRACE CONNECT } chunk_length 500000 server_flow_depth 0 client_flow_depth 0 post_depth 65495 oversize_dir_length 500 max_header_length 750 max_headers 100 ports { 80 443 8080 8443 } enable_cookie extended_response_inspection inspect_gzip normalize_utf unlimited_decompress

# RPC decode
preprocessor rpc_decode: 111 32770 32771 32772 32773 32774 32775 32776 32777 32778 32779 no_alert_multiple_requests no_alert_large_fragments no_alert_incomplete

# Back Orifice detection
preprocessor bo

# SSH anomaly detection
preprocessor ssh: server_ports { 22 } autodetect max_client_bytes 19600 max_encrypted_packets 20 max_server_version_len 100

# DNS anomaly detection
preprocessor dns: ports { 53 } enable_rdata_overflow

# SSL anomaly detection
preprocessor ssl: ports { 443 465 563 636 989 992 993 994 995 }, trustservers, noinspect_encrypted

###################################################
# Step #5: Configure output plugins
###################################################

# Fast alert output to file
output alert_fast: alert.ids

###################################################
# Step #6: Include rule files
###################################################

# metadata reference data - do not modify these lines
include classification.config
include reference.config

# site specific rules
include $RULE_PATH/community.rules
include $RULE_PATH/nmap.rules
include $RULE_PATH/test.rules

# Event thresholding or suppression commands
include threshold.conf
