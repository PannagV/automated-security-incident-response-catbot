#--------------------------------------------------
# Minimal Snort Configuration for IDS Mode
# Compatible with Snort 2.9.20
# Created for SecBot Project
#--------------------------------------------------

###################################################
# Step #1: Set the network variables
###################################################

# Setup the network addresses you are protecting
ipvar HOME_NET any

# Set up the external network addresses
ipvar EXTERNAL_NET any

# List of DNS servers on your network 
ipvar DNS_SERVERS $HOME_NET

# List of SMTP servers on your network
ipvar SMTP_SERVERS $HOME_NET

# List of web servers on your network
ipvar HTTP_SERVERS $HOME_NET

# List of sql servers on your network 
ipvar SQL_SERVERS $HOME_NET

# List of telnet servers on your network
ipvar TELNET_SERVERS $HOME_NET

# List of ssh servers on your network
ipvar SSH_SERVERS $HOME_NET

# List of ftp servers on your network
ipvar FTP_SERVERS $HOME_NET

# List of sip servers on your network
ipvar SIP_SERVERS $HOME_NET

# List of snmp servers on your network
ipvar SNMP_SERVERS $HOME_NET

# List of aim servers on your network
ipvar AIM_SERVERS [64.12.24.0/23,64.12.28.0/23,64.12.161.0/24,64.12.163.0/24,64.12.200.0/24,205.188.3.0/24,205.188.5.0/24,205.188.7.0/24,205.188.9.0/24,205.188.153.0/24,205.188.179.0/24,205.188.248.0/24]

# Port variables
portvar HTTP_PORTS [80,443,8080,8443]
portvar SHELLCODE_PORTS !80
portvar ORACLE_PORTS 1024:
portvar SSH_PORTS 22
portvar FTP_PORTS [21,2100,3535]
portvar SIP_PORTS [5060,5061,5600]
portvar FILE_DATA_PORTS [$HTTP_PORTS,110,143]
portvar GTP_PORTS [2123,2152,3386]

# Path to your rules files
var RULE_PATH ../rules
var SO_RULE_PATH ../so_rules
var PREPROC_RULE_PATH ../preproc_rules

# Reputation paths
var WHITE_LIST_PATH ../rules
var BLACK_LIST_PATH ../rules

###################################################
# Step #2: Configure the decoder
###################################################

# Stop generic decode events
config disable_decode_alerts

# Stop Alerts on experimental TCP options
config disable_tcpopt_experimental_alerts

# Stop Alerts on obsolete TCP options
config disable_tcpopt_obsolete_alerts

# Stop Alerts on T/TCP alerts
config disable_tcpopt_ttcp_alerts

# Stop Alerts on all other TCPOption type events
config disable_tcpopt_alerts

# Stop Alerts on invalid ip options
config disable_ipopt_alerts

# Configure IP / TCP checksum mode
config checksum_mode: all

###################################################
# Step #3: Configure the base detection engine
###################################################

# Configure PCRE match limitations
config pcre_match_limit: 3500
config pcre_match_limit_recursion: 1500

# Configure the detection engine
config detection: search-method ac-bnfa search-optimize max-pattern-len 20

# Configure the event queue
config event_queue: max_queue 8 log 5 order_events content_length

###################################################
# Step #4: Configure protocol aware flushing
###################################################
config paf_max: 16000

###################################################
# Step #5: Configure preprocessors (MINIMAL)
###################################################

# Target-based IP defragmentation
preprocessor frag3_global: max_frags 65536
preprocessor frag3_engine: policy windows detect_anomalies overlap_limit 10 min_fragment_length 100 timeout 180

# Target-Based stateful inspection/stream reassembly
preprocessor stream5_global: track_tcp yes, track_udp yes, track_icmp no, max_tcp 262144, max_udp 131072, max_active_responses 2, min_response_seconds 5
preprocessor stream5_tcp: policy windows, detect_anomalies, require_3whs 180, overlap_limit 10, small_segments 3 bytes 150, timeout 180
preprocessor stream5_udp: timeout 180

# HTTP normalization and anomaly detection
preprocessor http_inspect: global iis_unicode_map unicode.map 1252 compress_depth 65535 decompress_depth 65535
preprocessor http_inspect_server: server default chunk_length 500000 server_flow_depth 0 client_flow_depth 0 post_depth 65495 oversize_dir_length 500 max_header_length 750 max_headers 100 ports { 80 443 8080 8443 } enable_cookie extended_response_inspection inspect_gzip normalize_utf unlimited_decompress normalize_javascript

###################################################
# Step #6: Configure output plugins
###################################################

# No output plugins needed for fast alert mode

###################################################
# Step #7: Customize your rule set
###################################################

# metadata reference data
include classification.config
include reference.config

# site specific rules
include $RULE_PATH/nmap.rules

# Conditionally include community rules if they exist
# include $RULE_PATH/community.rules
# include $RULE_PATH/test.rules

# Event thresholding or suppression commands
# include threshold.conf
